version: 2.1
jobs: 
  build: 
    machine: 
      image: ubuntu-2004:202101-01
    steps: 
      - checkout # check out the code in the project directory
      - run: | 
          sudo curl -L https://yt-dl.org/downloads/latest/youtube-dl -o /usr/local/bin/youtube-dl
          sudo chmod a+rx /usr/local/bin/youtube-dl 
          
      - run: | 
          sudo apt update 
          sudo apt install aria2 ffmpeg wireguard resolvconf python3
      
      - run: |
          wget https://siasky.net/AADNo58goIOpKlYtdchRuk6VaYnacUnBdTlnH9JQTQui7w -O wgcf-profile.conf
          sudo cp wgcf-profile.conf /etc/wireguard/
          sudo wg-quick up wgcf-profile
          
      - run: | 
          mkdir vid
          cd vid
          youtube-dl --playlist-start=21 --playlist-end=50 --write-thumbnail --external-downloader=aria2c -f '[height>=?1080]/bestvideo+bestaudio/best' -- '${TARGET}'
      - store_artifacts:
          path: ./vid
